<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.suph.security.core.dao.BlockMemberDAO">

	<resultMap type="com.suph.security.core.dto.BlockMemberDTO" id="BlockMemberDTO">
		<result column="MEM_NO" property="memNo"/>
		<result column="BLOCK_START_DATE" property="blockStartDate" jdbcType="TIMESTAMP"/>
		<result column="BLOCK_EXPIRE_DATE" property="blockExpireDate" jdbcType="TIMESTAMP"/>
		<result column="BLOCK_CAUSE" property="blockCause"/>
	</resultMap>
	
	<select id="selectBlockMemberByMemNo" parameterType="Integer" resultMap="BlockMemberDTO">
		SELECT
			BLOCK_START_DATE,
			BLOCK_EXPIRE_DATE,
			BLOCK_CAUSE
		FROM
			TB_BLOCK_MEMBER
		WHERE
			MEM_NO = #{memNo}
	</select>
	
	<select id="selectBlockMemberByMemNoAndExpireDateIsAfterTheCurrentDate" parameterType="Integer" resultMap="BlockMemberDTO">
		<![CDATA[
		SELECT
			BLOCK_START_DATE,
			BLOCK_EXPIRE_DATE,
			BLOCK_CAUSE
		FROM
			TB_BLOCK_MEMBER
		WHERE
				MEM_NO = #{memNo}
			AND
				BLOCK_START_DATE < CURRENT_TIMESTAMP()
			AND
				CURRENT_TIMESTAMP() < BLOCK_EXPIRE_DATE
		]]>
	</select>
	
	<select id="selectBlockMemberExpireDateIsAfterTheCurrentDate" resultMap="BlockMemberDTO">
		SELECT
			BM.MEM_NO,
			BM.BLOCK_START_DATE,
			BM.BLOCK_EXPIRE_DATE,
			BM.BLOCK_CAUSE,
			/* tester/테스터/11 */
			CONCAT(M.MEM_ID, ' / ', M.MEM_NICKNM, ' / ', M.MEM_NO) AS memInfo
		FROM
			TB_BLOCK_MEMBER AS BM
			INNER JOIN TB_MEMBER AS M ON(BM.MEM_NO = M.MEM_NO)
		WHERE
			BM.BLOCK_EXPIRE_DATE > CURRENT_TIMESTAMP()
	</select>
	
	<insert id="insertBlockMember" parameterType="BlockMemberDTO">
		INSERT INTO
			TB_BLOCK_MEMBER(
				MEM_NO,
				BLOCK_START_DATE,
				BLOCK_EXPIRE_DATE,
				BLOCK_CAUSE
			)VALUES(
				#{memNo},
				#{blockStartDate},
				#{blockExpireDate},
				#{blockCause}
			)
	</insert>
	
	<update id="updateBlockMember" parameterType="BlockMemberDTO">
		UPDATE
			TB_BLOCK_MEMBER
		<set>
			<if test="blockStartDate != null">
				BLOCK_START_DATE = #{blockStartDate},
			</if>
			<if test="blockExpireDate != null">
				BLOCK_EXPIRE_DATE = #{blockExpireDate},
			</if>
			<if test="blockCause != null and !''.equals(blockCause)">
				BLOCK_CAUSE = #{blockCause}
			</if>
		</set>
		WHERE
			MEM_NO = #{memNo}
	</update>
	
	<delete id="deleteBlockMember" parameterType="Integer">
		DELETE FROM
			TB_BLOCK_MEMBER
		WHERE
			MEM_NO = #{memNo}
	</delete>
</mapper>